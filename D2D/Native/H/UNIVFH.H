/**************************************************************************
Copyright (C) 2016 Arcserve, including its affiliates and subsidiaries.
All rights reserved.  Any third party trademarks or copyrights are the
property of their respective owners.

 Program Name:	 Win32 Agent

**************************************************************************/
// for platforms with big endian byte ordering, reverse bytes for all
// signatures so that no dynamic byte swapping is necessary

//
//	Stream Header Structure
//
#pragma once

typedef struct _CTF_UNIV_STREAM_ID 
{
	DWORD dwSignature;
	DWORD dwStreamId;
	DWORD dwStreamAttributes;
	DWORD dwStreamSizeLow;
	DWORD dwStreamSizeHigh;
	DWORD dwStreamNameSize;
	DWORD dwStreamClass;
	DWORD dwStreamFlags;
}	CTF_UNIV_STREAM_ID, *PCTF_UNIV_STREAM_ID;

#define	CTF_UNIV_STREAM_ID_SIZE	sizeof(CTF_UNIV_STREAM_ID)
#define WIN32_FIND_DATA_SIZE	sizeof(WIN32_FIND_DATA)
#ifdef _WIN95AGENT
#define PATH_SIZE		512
#else
#define PATH_SIZE		1024
#endif

#define MAX_PATH_ALLOC	MAX_PATH //512
//
//	Stream Signature Definitions
//

#ifdef BIG_ENDIAN
#define  UNIVERSAL_FH_SIGNATURE			    0xBAABBAAB
#define  STREAM_HEADER_SIGNATURE		    0xCAACCAAC
#else
#define  UNIVERSAL_FH_SIGNATURE			    0xABBAABBA
#define  STREAM_HEADER_SIGNATURE		    0xACCAACCA
#endif


//
//	Stream ID Definitions
//

#ifdef BIG_ENDIAN
#define STREAM_ID_NO_MORE_STREAMS			0x00000000
#define STREAM_ID_DATA_STREAM				0x0100DAAD
#define STREAM_ID_AFP_INFO					0x0200DAAD
#define STREAM_ID_TRUSTEES  				0x0300DAAD	//	list of 4-byte ID + 
														//	2-byte rights mask or 
														//	2-byte rights mask + NDS Name
#define STREAM_ID_HSM_KEY   				0x0400DAAD
#define STREAM_ID_CRC						0x0500DAAD
#define STREAM_ID_SPARSE_FILE_MAP			0x0600DAAD
#else
#define STREAM_ID_NO_MORE_STREAMS			0x00000000
#define STREAM_ID_DATA_STREAM				0xADDA0001
#define STREAM_ID_AFP_INFO					0xADDA0002
#define STREAM_ID_TRUSTEES  				0xADDA0003	// list of 4-byte ID + 
														//	2-byte rights mask or 
														//	2-byte rights mask + NDS Name
#define STREAM_ID_HSM_KEY   				0xADDA0004
#define STREAM_ID_CRC						0xADDA0005
#define STREAM_ID_SPARSE_FILE_MAP			0xADDA0006
#endif

// Schema IDs
#ifdef BIG_ENDIAN
// #define STREAM_ID_DS_SCHEMA				0x0700DAAD
// #define STREAM_ID_DS_OBJECT				0x0800DAAD
#define STREAM_ID_DOS_INFO				    0x0900DAAD
#define STREAM_ID_OS2_INFO				    0x0A00DAAD
#define STREAM_ID_UNIX_INFO				    0x0B00DAAD
#define STREAM_ID_PATH					    0x0C00DAAD
#define STREAM_ID_VOL_RESTRICTIONS 		    0x0D00DAAD  // list of 4-byte ID + 
                                                        //  4 byte restriction/ 
                                                        //  or 4-byte restriction + NDS Name
#define STREAM_ID_EA					    0x0E00DAAD
#define STREAM_ID_OWNER					    0x0F00DAAD
#define STREAM_ID_DATA_TYPE				    0x1000DAAD
#define STREAM_ID_ERROR					    0x1100DAAD  // error occurred before end
#define STREAM_ID_ATTR_DEF_BEGIN		    0x1200DADA
#define STREAM_ID_ATTR_NAME				    0x1300DADA
#define STREAM_ID_ATTR_INFO				    0x1400DADA
#define STREAM_ID_ATTR_DEF_END			    0x1500DADA
#define STREAM_ID_CLASS_DEF_BEGIN		    0x1600DADA
#define STREAM_ID_CLASS_NAME			    0x1700DADA
#define STREAM_ID_CLASS_INFO			    0x1800DADA
#define STREAM_ID_SUPER_CLASS_LIST	        0x1900DADA
#define STREAM_ID_CONTAINMENT_CLASS_LIST    0x1A00DADA
#define STREAM_ID_NAMING_ATTR_LIST 		    0x1B00DADA
#define STREAM_ID_MANDATORY_ATTR_LIST 	    0x1C00DADA
#define STREAM_ID_OPTIONAL_ATTR_LIST		0x1D00DADA
#define STREAM_ID_CLASS_ITEM				0x1E00DADA
#define STREAM_ID_CLASS_DEF_END 			0x1F00DADA
#define STREAM_ID_PARTITION_INFO			0x2000DADA	
#else
// #define STREAM_ID_DS_SCHEMA				0xADDA0007
// #define STREAM_ID_DS_OBJECT				0xADDA0008
#define STREAM_ID_DOS_INFO				    0xADDA0009
#define STREAM_ID_OS2_INFO				    0xADDA000A
#define STREAM_ID_UNIX_INFO				    0xADDA000B
#define STREAM_ID_PATH					    0xADDA000C
#define STREAM_ID_VOL_RESTRICTIONS 		    0xADDA000D  // list of 4-byte ID + 
                                                        //  4 byte restriction/ 
                                                        //  or 4-byte restriction + NDS Name
#define STREAM_ID_EA						0xADDA000E
#define STREAM_ID_OWNER					    0xADDA000F
#define STREAM_ID_DATA_TYPE				    0xADDA0010
#define STREAM_ID_ERROR					    0xADDA0011  // error occurred before end
#define STREAM_ID_ATTR_DEF_BEGIN			0xADDA0012
#define STREAM_ID_ATTR_NAME			        0xADDA0013
#define STREAM_ID_ATTR_INFO			        0xADDA0014
#define STREAM_ID_ATTR_DEF_END		        0xADDA0015         
#define STREAM_ID_CLASS_DEF_BEGIN			0xADDA0016
#define STREAM_ID_CLASS_NAME				0xADDA0017
#define STREAM_ID_CLASS_INFO				0xADDA0018
#define STREAM_ID_SUPER_CLASS_LIST	        0xADDA0019
#define STREAM_ID_CONTAINMENT_CLASS_LIST	0xADDA001A
#define STREAM_ID_NAMING_ATTR_LIST 		    0xADDA001B
#define STREAM_ID_MANDATORY_ATTR_LIST 	    0xADDA001C
#define STREAM_ID_OPTIONAL_ATTR_LIST		0xADDA001D	
#define STREAM_ID_CLASS_ITEM				0xADDA001E
#define STREAM_ID_CLASS_DEF_END 			0xADDA001F
#define STREAM_ID_PARTITION_INFO			0xADDA0020
#endif

// Id for DBAGENT
#ifdef BIG_ENDIAN
#define STREAM_ID_DBA_INFO				    0x2100DAAD
#define STREAM_ID_DATA_STREAM_STRIPE		0x2200DAAD
#define STREAM_ID_DATA_STREAM_OVERLAPPED	0x2300DAAD
#else
#define STREAM_ID_DBA_INFO				    0xADDA0021
#define STREAM_ID_DATA_STREAM_STRIPE		0xADDA0022
#define STREAM_ID_DATA_STREAM_OVERLAPPED	0xADDA0023
#endif

// id for catalog
#ifdef BIG_ENDIAN
#define STREAM_ID_CATALOG					0x3010DAAD
#else
#define STREAM_ID_CATALOG					0xADDA1030
#endif



// DS object IDs
#ifdef BIG_ENDIAN
#define STREAM_ID_NEW_CONTEXT 		        0x0F00DADA
#define STREAM_ID_OBJECT_ID_BEGIN 	        0x1000DADA
#define STREAM_ID_OBJECT_ID_NAME 			0x1100DADA
#define STREAM_ID_OBJECT_ID_INFO 			0x1200DADA
#define STREAM_ID_OBJECT_ID_DATA			0x1300DADA
#define STREAM_ID_OBJECT_ID_END 			0x1400DADA
#else
#define STREAM_ID_NEW_CONTEXT 		        0xDADA000F
#define STREAM_ID_OBJECT_ID_BEGIN 	        0xDADA0010
#define STREAM_ID_OBJECT_ID_NAME 			0xDADA0011
#define STREAM_ID_OBJECT_ID_INFO 			0xDADA0012
#define STREAM_ID_OBJECT_ID_DATA			0xDADA0013
#define STREAM_ID_OBJECT_ID_END 			0xDADA0014
#endif

// Unix OES
#ifdef BIG_ENDIAN
#define STREAM_ID_SMS_SCAN_INFO				0x6000DAAD
#define STREAM_ID_SMS_NAME_LIST				0x7000DAAD
#else
#define STREAM_ID_SMS_SCAN_INFO				0xADDA0060
#define STREAM_ID_SMS_NAME_LIST				0xADDA0070
#endif


//
//	Stream Class Definitions
//

// trustee and vol restriction classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_BINDERY_ID			    0x1500DADA
#define STREAM_CLASS_NDS_NAME				0x1600DADA
#else
#define STREAM_CLASS_BINDERY_ID			    0xDADA0015
#define STREAM_CLASS_NDS_NAME				0xDADA0016
#endif

// path classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_STARTING_PATH		    0x1700DADA
#define STREAM_CLASS_RELATIVE_PATH		    0x1800DADA
#define STREAM_CLASS_FULL_PATH			    0x1900DADA
#else
#define STREAM_CLASS_STARTING_PATH		    0xDADA0017
#define STREAM_CLASS_RELATIVE_PATH		    0xDADA0018
#define STREAM_CLASS_FULL_PATH			    0xDADA0019
#endif

// CRC classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_CRC_CSS_CHECKSUM		0x1A00DADA
#else
#define STREAM_CLASS_CRC_CSS_CHECKSUM		0xDADA001A
#endif

// data stream classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_NORMAL_DATA			0x2000DADA
#define STREAM_CLASS_SYBASE_DBAGENT_DATA 	0x2100DADA	
#define STREAM_CLASS_DBAGENT_DATA 		    0x2100DADA	// SUNN
#define STREAM_CLASS_SMS_DATA				0x2200DADA
#define STREAM_CLASS_SPARSE_DATA			0x2300DADA
#define STREAM_CLASS_NOTES_DBAGENT_DATA     0x2400DADA
#define	STREAM_CLASS_DISK_IMAGE_DATA        0x2500DADA
#define STREAM_CLASS_AD_TOKEN				0x2600DADA  // Active Directory Token
#else
#define STREAM_CLASS_NORMAL_DATA			0xDADA0020
#define STREAM_CLASS_STBASE_DBAGENT_DATA 	0xDADA0021	
#define STREAM_CLASS_DBAGENT_DATA 		    0xDADA0021	// SUNN
#define STREAM_CLASS_SMS_DATA				0xDADA0022
#define STREAM_CLASS_SPARSE_DATA			0xDADA0023
#define STREAM_CLASS_NOTES_DBAGENT_DATA     0xDADA0024
#define	STREAM_CLASS_DISK_IMAGE_DATA        0xDADA0025
#define STREAM_CLASS_AD_TOKEN				0xDADA0026  // Active Directory Token
#endif

// data type classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_FILE					0x3000DADA
#define STREAM_CLASS_DIRECTORY			    0x3100DADA
#define STREAM_CLASS_BINDERY_NW2X			0x3200DADA  // consists of 2 streams
#define STREAM_CLASS_BINDERY_NW3X			0x3300DADA  // consists of 3 streams
#define STREAM_CLASS_DS_OBJECT			    0x3400DADA
#define STREAM_CLASS_DS_SCHEMA			    0x3500DADA
#define STREAM_CLASS_SYBASE_DB			    0x3600DADA
#define STREAM_CLASS_VOLUME				    0x3700DADA
#define STREAM_CLASS_SESSION_INFO			0x3800DADA
#define STREAM_CLASS_NOTES_DB				0x3900DADA
#define STREAM_CLASS_DISK_PARTITION		    0x3A00DADA

#ifdef _w2k_ASNT70_Disk_Quota_Support

#define STREAM_CLASS_DISKQUOTA_DEFAULTS		0x3b00dada
#define STREAM_CLASS_DISKQUOTA_USERINFO		0x3c00dada

#endif

#define STREAM_CLASS_SYSTEMSTATE_COMPONENT_FLAGS	0x003fdada
#define STREAM_CLASS_ROOTDIRECTORY					0x3d00dada
#define STREAM_CLASS_VIRTUALPATH					0x3e00dada
#define STREAM_CLASS_PVPATH							0x4000dada	
#define STREAM_CLASS_ROOTDIRECTORY_ANSI				0x4100dada

#else

#define STREAM_CLASS_FILE					0xDADA0030
#define STREAM_CLASS_DIRECTORY			    0xDADA0031
#define STREAM_CLASS_BINDERY_NW2X			0xDADA0032  // consists of 2 streams
#define STREAM_CLASS_BINDERY_NW3X			0xDADA0033  // consists of 3 streams
#define STREAM_CLASS_DS_OBJECT			    0xDADA0034
#define STREAM_CLASS_DS_SCHEMA			    0xDADA0035
#define STREAM_CLASS_SYBASE_DB			    0xDADA0036
#define STREAM_CLASS_VOLUME				    0xDADA0037
#define STREAM_CLASS_SESSION_INFO			0xDADA0038
#define STREAM_CLASS_NOTES_DB				0xDADA0039
#define STREAM_CLASS_DISK_PARTITION		    0xDADA003A

#ifdef _w2k_ASNT70_Disk_Quota_Support
#define STREAM_CLASS_DISKQUOTA_DEFAULTS		0xdada003b
#define STREAM_CLASS_DISKQUOTA_USERINFO		0xdada003c
#endif

#define STREAM_CLASS_ROOTDIRECTORY					0xdada003d
#define STREAM_CLASS_VIRTUALPATH					0xdada003e
#define STREAM_CLASS_SYSTEMSTATE_COMPONENT_FLAGS	0xdada003f		
#define STREAM_CLASS_PVPATH							0xdada0040
#define STREAM_CLASS_ROOTDIRECTORY_ANSI				0xdada0041
#endif

//#ifdef WANSYNC_SUPPORT
#ifdef BIG_ENDIAN
#define STREAM_CLASS_SCENERIO_XML           0x4200dada
#define STREAM_CLASS_SCENERIO_INFO          0x4300dada
#define STREAM_CLASS_LOGICAL_MASTER_PATH    0x4400dada
#define STREAM_CLASS_PHYSICAL_REPLICA_PATH  0x4500dada
#else
#define STREAM_CLASS_SCENERIO_XML           0xdada0042
#define STREAM_CLASS_SCENERIO_INFO          0xdada0043
#define STREAM_CLASS_LOGICAL_MASTER_PATH    0xdada0044
#define STREAM_CLASS_PHYSICAL_REPLICA_PATH  0xdada0045
#endif
//#endif //WANSYNC_SUPPORT

//#ifdef VMWARE_SUPPORT
#ifdef BIG_ENDIAN
#define STREAM_CLASS_VMWARE_HOSTS			0x4600dada
#define STREAM_CLASS_VMWARE_XML				0x4700dada
#define STREAM_CLASS_VMWARE_PHYSICAL_PATH	0x4800dada
#define STREAM_CLASS_VMWARE_FS_ROOT			0x4900dada	// R12V_VM_TASKS
#define STREAM_CLASS_VMWARE_FS_VOLUME		0x4a00dada
#define STREAM_CLASS_VMWARE_FS_CATALOG		0x4b00dada
#define STREAM_CLASS_VMWARE_FS_IMGMETA		0x4c00dada
#define STREAM_CLASS_VMWARE_FS_CLUSTERMAP	0x4d00dada
#define STREAM_CLASS_VMWARE_FS_DIRSTRUCT	0x4e00dada
#define STREAM_CLASS_VMWARE_FS_DACE			0x4f00dada
#define STREAM_CLASS_VMWARE_FS_SACE			0x5000dada
#define STREAM_CLASS_VMWARE_FS_SECURITY		0x5100dada
#define STREAM_CLASS_VMWARE_FS_NTFSDEDUPE	0x6700dada
#else
#define STREAM_CLASS_VMWARE_HOSTS			0xdada0046
#define STREAM_CLASS_VMWARE_XML				0xdada0047
#define STREAM_CLASS_VMWARE_PHYSICAL_PATH	0xdada0048
#define STREAM_CLASS_VMWARE_FS_ROOT			0xdada0049	// R12V_VM_TASKS
#define STREAM_CLASS_VMWARE_FS_VOLUME		0xdada004a
#define STREAM_CLASS_VMWARE_FS_CATALOG		0xdada004b
#define STREAM_CLASS_VMWARE_FS_IMGMETA		0xdada004c
#define STREAM_CLASS_VMWARE_FS_CLUSTERMAP	0xdada004d
#define STREAM_CLASS_VMWARE_FS_DIRSTRUCT	0xdada004e
#define STREAM_CLASS_VMWARE_FS_DACE			0xdada004f
#define STREAM_CLASS_VMWARE_FS_SACE			0xdada0050
#define STREAM_CLASS_VMWARE_FS_SECURITY		0xdada0051
#define STREAM_CLASS_VMWARE_FS_NTFSDEDUPE	0xdada0067
#endif
//#endif //VMWARE_SUPPORT

// R12V_VM_TASKS HYPERV_SUPPORT
#ifdef BIG_ENDIAN
#define STREAM_CLASS_HYPERV_SNAPSHOT_METADATA_XML	0x5200dada
#define STREAM_CLASS_HYPERV_SNAPSHOT_BCD			0x5300dada
#define STREAM_CLASS_HYPERV_XML_VHD_FILENAME		0x5400dada
#define STREAM_CLASS_HYPERV_VMFRIENDNAME			0x5500dada
#define STREAM_CLASS_VOLUME_DISK_EXTENTS			0x5600dada		// BACKUP_BLI
#define STREAM_CLASS_VOLUME_BITMAP					0x5700dada
#define STREAM_CLASS_APP_BCD						0x5800dada
#define	STREAM_CLASS_APP_WRITER_METADATA			0x5900dada
#else
#define STREAM_CLASS_HYPERV_SNAPSHOT_METADATA_XML	0xdada0052
#define STREAM_CLASS_HYPERV_SNAPSHOT_BCD			0xdada0053
#define STREAM_CLASS_HYPERV_XML_VHD_FILENAME		0xdada0054
#define STREAM_CLASS_HYPERV_VMFRIENDNAME			0xdada0055
#define STREAM_CLASS_VOLUME_DISK_EXTENTS			0xdada0056		// BACKUP_BLI
#define STREAM_CLASS_VOLUME_BITMAP					0xdada0057
#define STREAM_CLASS_APP_BCD						0xdada0058
#define	STREAM_CLASS_APP_WRITER_METADATA			0xdada0059
#endif

#define STREAM_CLASS_PHYSICAL_PATH			STREAM_CLASS_PHYSICAL_REPLICA_PATH
#define STREAM_CLASS_LOGICAL_PATH			STREAM_CLASS_LOGICAL_MASTER_PATH

//
//	Stream Flags Definitions
//

// data stream flags
#ifdef BIG_ENDIAN
#define STREAM_FLAG_UNCOMPRESSED			0x00000000
#define STREAM_FLAG_NW4X_COMPRESSED		    0x01000000
#define STREAM_FLAG_TT_COMPRESSED			0x02000000
#define STREAM_FLAG_STAC_COMPRESSED		    0x04000000
#define STREAM_FLAG_ENCRYPTED_X			    0x08000000	// SUNN Was ?
#define STREAM_FLAG_UNICODE				    0x10000000
#define STREAM_FLAG_ASCSAT_ENCRYPTED		0x20000000
#define STREAM_FLAG_DEFLATE_COMPRESSED	    0x40000000 
#define STREAM_FLAG_FW_ENCRYPTED			0x80000000
#define STREAM_FLAG_ENCRYPT_BEGIN_DATA		0x00020000
#define STREAM_FLAG_ENCRYPT_END_DATA		0x00040000

#else
#define STREAM_FLAG_UNCOMPRESSED			0x00000000
#define STREAM_FLAG_NW4X_COMPRESSED		    0x00000001
#define STREAM_FLAG_TT_COMPRESSED			0x00000002
#define STREAM_FLAG_STAC_COMPRESSED		    0x00000004
#define STREAM_FLAG_ENCRYPTED_X			    0x00000008	//	SUNN Was ?
#define STREAM_FLAG_UNICODE				    0x00000010
#define STREAM_FLAG_ASCSAT_ENCRYPTED		0x00000020
#define STREAM_FLAG_DEFLATE_COMPRESSED	    0x00000040 
#define STREAM_FLAG_FW_ENCRYPTED			0x00000080

#define STREAM_FLAG_ENCRYPT_BEGIN_DATA		0x00000200
#define STREAM_FLAG_ENCRYPT_END_DATA		0x00000400




#endif

// STREAM_ID_NO_MORE_STREAMS flags
#ifdef BIG_ENDIAN
#define STREAM_FLAG_INVALID				    0x20000000
#else
#define STREAM_FLAG_INVALID				    0x00000020
#endif

//
//	Stream Attributes Definitions
//

// data type and path attributes for files and directories
#ifdef BIG_ENDIAN
#define STREAM_ATTRIBUTE_DOS_NAME_SPACE 	0x00000000
#define STREAM_ATTRIBUTE_MAC_NAME_SPACE 	0x01000000
#define STREAM_ATTRIBUTE_NFS_NAME_SPACE 	0x02000000
#define STREAM_ATTRIBUTE_FTAM_NAME_SPACE 	0x03000000
#define STREAM_ATTRIBUTE_OS2_NAME_SPACE 	0x04000000
#define STREAM_ATTRIBUTE_NT_NAME_SPACE 	    0x05000000
#else
#define STREAM_ATTRIBUTE_DOS_NAME_SPACE 	0x00000000
#define STREAM_ATTRIBUTE_MAC_NAME_SPACE 	0x00000001
#define STREAM_ATTRIBUTE_NFS_NAME_SPACE 	0x00000002
#define STREAM_ATTRIBUTE_FTAM_NAME_SPACE 	0x00000003
#define STREAM_ATTRIBUTE_OS2_NAME_SPACE 	0x00000004
#define STREAM_ATTRIBUTE_NT_NAME_SPACE 	    0x00000005
#endif

// data stream attributes
#ifdef BIG_ENDIAN
#define STREAM_ATTRIBUTE_DATA_FORK		    0x00000000
#define STREAM_ATTRIBUTE_RESOURCE_FORK	    0x10000000
#else
#define STREAM_ATTRIBUTE_DATA_FORK		    0x00000000
#define STREAM_ATTRIBUTE_RESOURCE_FORK	    0x00000010
#endif

// Stream Attributes for streamID(STREAM_ID_DATA_STREAM_STRIPE)
#ifdef BIG_ENDIAN
#define STREAM_ATTRIBUTE_DATA_STRIPE0		0x00000000
#define STREAM_ATTRIBUTE_DATA_STRIPE1		0x01000000
#define STREAM_ATTRIBUTE_DATA_STRIPE2		0x02000000
#define STREAM_ATTRIBUTE_DATA_STRIPE3		0x03000000
#define STREAM_ATTRIBUTE_DATA_STRIPE4		0x04000000
#define STREAM_ATTRIBUTE_DATA_STRIPE5		0x05000000
#define STREAM_ATTRIBUTE_DATA_STRIPE6		0x06000000
#define STREAM_ATTRIBUTE_DATA_STRIPE7		0x07000000
#define STREAM_ATTRIBUTE_DATA_STRIPE8		0x08000000
#define STREAM_ATTRIBUTE_DATA_STRIPE9		0x09000000
#define STREAM_ATTRIBUTE_DATA_STRIPE10	    0x0a000000
#define STREAM_ATTRIBUTE_DATA_STRIPE11	    0x0b000000
#define STREAM_ATTRIBUTE_DATA_STRIPE12	    0x0c000000
#define STREAM_ATTRIBUTE_DATA_STRIPE13	    0x0d000000
#define STREAM_ATTRIBUTE_DATA_STRIPE14	    0x0e000000
#define STREAM_ATTRIBUTE_DATA_STRIPE15	    0x0f000000
#else
#define STREAM_ATTRIBUTE_DATA_STRIPE0		0x00000000
#define STREAM_ATTRIBUTE_DATA_STRIPE1		0x00000001
#define STREAM_ATTRIBUTE_DATA_STRIPE2		0x00000002
#define STREAM_ATTRIBUTE_DATA_STRIPE3		0x00000003
#define STREAM_ATTRIBUTE_DATA_STRIPE4		0x00000004
#define STREAM_ATTRIBUTE_DATA_STRIPE5		0x00000005
#define STREAM_ATTRIBUTE_DATA_STRIPE6		0x00000006
#define STREAM_ATTRIBUTE_DATA_STRIPE7		0x00000007
#define STREAM_ATTRIBUTE_DATA_STRIPE8		0x00000008
#define STREAM_ATTRIBUTE_DATA_STRIPE9		0x00000009
#define STREAM_ATTRIBUTE_DATA_STRIPE10		0x0000000a
#define STREAM_ATTRIBUTE_DATA_STRIPE11		0x0000000b
#define STREAM_ATTRIBUTE_DATA_STRIPE12		0x0000000c
#define STREAM_ATTRIBUTE_DATA_STRIPE13		0x0000000d
#define STREAM_ATTRIBUTE_DATA_STRIPE14		0x0000000e
#define STREAM_ATTRIBUTE_DATA_STRIPE15		0x0000000f
#endif


// stream processing return values
#ifdef BIG_ENDIAN
#define PROCESSED_STREAM				    0x00000000
#define DID_NOT_PROCESS_STREAM			    0x01000000
#define ERROR_PROCESSING_STREAM			    0xffffffff
#else
#define PROCESSED_STREAM				    0x00000000
#define DID_NOT_PROCESS_STREAM			    0x00000001
#define ERROR_PROCESSING_STREAM			    0xffffffff
#endif


// NT-Win95 Universal file format
//	Stream ID Definitions
#ifdef BIG_ENDIAN
#define STREAM_ID_NT_INFO					0x2110DAAD
#define STREAM_ID_EA_DATA_STREAM			0x2210DAAD
#define STREAM_ID_SECURITY_DATA_STREAM		0x2310DAAD
#define STREAM_ID_ALTERNATE_DATA_STREAM		0x2410DAAD
#define STREAM_ID_LINK_DATA_STREAM			0x2510DAAD
#define	STREAM_ID_PROPERTY_DATA				0x2610DAAD	//win2000 new stream
#define	STREAM_ID_OBJECT_ID					0x2710DAAD	//win2000 new stream
#define	STREAM_ID_REPARSE_DATA				0x2810DAAD	//win2000 new stream
#define	STREAM_ID_SPARSE_BLOCK				0x2910DAAD	//win2000 new stream
#define STREAM_ID_ENCRYPTED_DATA_STREAM		0x3110DAAD	//win2000 new stream
#define	STREAM_ID_AD_DATA_STREAM			0x3210DAAD	//win2000 new stream	//R12V_VM_WIN32AGENT
#define STREAM_ID_VSS_PARTIAL_FILE			0x3310DAAD  // R12.V_SQL_DIFF		//R12V_VM_WIN32AGENT
#else
#define STREAM_ID_NT_INFO					0xADDA1021
#define STREAM_ID_EA_DATA_STREAM			0xADDA1022
#define STREAM_ID_SECURITY_DATA_STREAM		0xADDA1023
#define STREAM_ID_ALTERNATE_DATA_STREAM		0xADDA1024
#define STREAM_ID_LINK_DATA_STREAM			0xADDA1025
#define	STREAM_ID_PROPERTY_DATA				0xADDA1026	//win2000 new stream
#define	STREAM_ID_OBJECT_ID					0xADDA1027	//win2000 new stream
#define	STREAM_ID_REPARSE_DATA				0xADDA1028	//win2000 new stream
#define	STREAM_ID_SPARSE_BLOCK				0xADDA1029	//win2000 new stream
#define STREAM_ID_ENCRYPTED_DATA_STREAM		0xADDA1031	//win2000 new stream	//R12V_VM_WIN32AGENT
#define STREAM_ID_AD_DATA_STREAM			0xADDA1032	//win2000 new stream	//R12V_VM_WIN32AGENT
#define STREAM_ID_VSS_PARTIAL_FILE			0xADDA1033  // R12.V_SQL_DIFF
#endif

// OpenVMS Universal file format
#ifdef BIG_ENDIAN
#define STREAM_ID_OPENVMS_INFO				0x4010DAAD
#else
#define STREAM_ID_OPENVMS_INFO				0xADDA1040
#endif

// data type classes
#ifdef BIG_ENDIAN
#define STREAM_CLASS_NT_REGISTRY_FILE	    0x5B00DADA
#define STREAM_CLASS_NT_EVENT_LOG_FILE	    0x5C00DADA
#define STREAM_CLASS_NT_REGISTRY_KEY	    0x5D00DADA
#define STREAM_CLASS_NT_REGISTRY_VALUE	    0x5E00DADA
#else
#define STREAM_CLASS_NT_REGISTRY_FILE	    0xDADA005B
#define STREAM_CLASS_NT_EVENT_LOG_FILE	    0xDADA005C
#define STREAM_CLASS_NT_REGISTRY_KEY	    0xDADA005D
#define STREAM_CLASS_NT_REGISTRY_VALUE	    0xDADA005E
#endif

// data stream flags
#ifdef BIG_ENDIAN
#define STREAM_FLAG_PKW_COMPRESSED			0x00010000
#define STREAM_FLAG_GNU_COMPRESSED			0x00020000
#define STREAM_FLAG_USR_COMPRESSED			0x00040000
#define STREAM_FLAG_USR_ENCRYPTED			0x00080000
#else
#define STREAM_FLAG_PKW_COMPRESSED			0x00000100
#define STREAM_FLAG_GNU_COMPRESSED			0x00000200
#define STREAM_FLAG_USR_COMPRESSED			0x00000400
#define STREAM_FLAG_USR_ENCRYPTED			0x00000800
#endif

//	Data Stream Attributes Definitions
#ifdef BIG_ENDIAN
#define STREAM_ATTRIBUTE_NT_REG_SZ									0x00010000
#define STREAM_ATTRIBUTE_NT_REG_MULTI_SZ							0x00020000
#define STREAM_ATTRIBUTE_NT_REG_EXPAND_SZ							0x00030000
#define STREAM_ATTRIBUTE_NT_REG_DWORD								0x00040000
#define STREAM_ATTRIBUTE_NT_REG_BINARY								0x00050000
#define STREAM_ATTRIBUTE_NT_REG_DWORD_BIG_ENDIAN					0x00060000
#define STREAM_ATTRIBUTE_NT_REG_LINK								0x00070000
#define STREAM_ATTRIBUTE_NT_REG_RESOURCE_LIST						0x00080000
#define STREAM_ATTRIBUTE_NT_REG_FULL_RESOURCE_DESCRIPTOR			0x00090000
#define STREAM_ATTRIBUTE_NT_REG_FULL_RESOURCE_REQUIREMENTS_LIST		0x000A0000
#else
#define STREAM_ATTRIBUTE_NT_REG_SZ									0x00000100
#define STREAM_ATTRIBUTE_NT_REG_MULTI_SZ							0x00000200
#define STREAM_ATTRIBUTE_NT_REG_EXPAND_SZ							0x00000300
#define STREAM_ATTRIBUTE_NT_REG_DWORD								0x00000400
#define STREAM_ATTRIBUTE_NT_REG_BINARY								0x00000500
#define STREAM_ATTRIBUTE_NT_REG_DWORD_BIG_ENDIAN					0x00000600
#define STREAM_ATTRIBUTE_NT_REG_LINK								0x00000700
#define STREAM_ATTRIBUTE_NT_REG_RESOURCE_LIST						0x00000800
#define STREAM_ATTRIBUTE_NT_REG_FULL_RESOURCE_DESCRIPTOR			0x00000900
#define STREAM_ATTRIBUTE_NT_REG_FULL_RESOURCE_REQUIREMENTS_LIST		0x00000A00
#endif



// Add by Gil
// 2007-3-28 3:26:45
#ifdef BIG_ENDIAN
#define STREAM_FLAG_DEFLATE_BLOCK_COMPRESSED	0x00100000
#define STREAM_FLAG_BLOCK_ENCRYPTED				0x00200000
#else // BIG_ENDIAN
#define STREAM_FLAG_DEFLATE_BLOCK_COMPRESSED	0x00001000
#define STREAM_FLAG_BLOCK_ENCRYPTED				0x00002000
#endif // BIG_ENDIAN
// End add by Gil 2007-3-28 3:26:45


// Add by Gil
// 2007-3-28 3:30:10
typedef struct STREAM_BLOCK_HEADER
{
	unsigned __int8 cbSize;
	unsigned __int8 flag;
	unsigned __int16 afterSize;
	unsigned __int16 beforeSize;
}ST_STREAM_BLOCK_HEADER , ST_STREAM_BLOCK_HEADER_V_1;
// End add by Gil 2007-3-28 3:30:10

// Add by Gil
// 2007-3-28 3:42:19
#define BLOCK_FLAG_COMPRESSED			0x80
#define BLOCK_FLAG_ETPKI_ENCRYPTED		0x40	// use ASETPKIEncrypt in ASDCEN to decrypt
#define BLOCK_FLAG_TNG_ENCRYPTED		0x20	// use ASCSATGDecrypt in ASDCEN to decrypt
// End add by Gil 2007-3-28 3:42:19


